<div class="row" *ngIf="!isLoading">
  <div class="col-md-8 mx-auto">
    <div class="card">
      <div class="card-body text-center">
        <img 
          [src]="user?.profilePicture || '../../../../public/profile.jpg'" 
          class="rounded-circle mb-3" 
          alt="Profile"
          style="width: 150px; height: 150px; object-fit: cover;">
        <h3>{{user?.username || 'Unknown User'}}</h3>
        <p class="text-muted">{{user?.email}}</p>
        <p *ngIf="user?.bio" class="mb-3">{{user.bio}}</p>
        <p class="text-muted small">Member since: {{user?.createdDate | date:'MMM yyyy'}}</p>
        <button 
          *ngIf="isOwnProfile" 
          class="btn btn-outline-primary">Edit Profile</button>
      </div>
    </div>
    
    <!-- User Posts -->
    <div class="mt-4" *ngIf="posts.length > 0">
      <h4>Posts ({{posts.length}})</h4>
      <div class="card mb-3" *ngFor="let post of posts">
        <div class="card-body">
          <p>{{post.content}}</p>
          <div *ngIf="post.imageUrl" class="mb-3">
            <video *ngIf="post.mediaType === 'video'" 
                   [src]="post.imageUrl" 
                   controls 
                   autoplay 
                   muted 
                   loop
                   class="img-fluid rounded" 
                   style="max-width: 100%; max-height: 400px;">
            </video>
            <img *ngIf="post.mediaType !== 'video'" 
                 [src]="post.imageUrl" 
                 class="img-fluid rounded" 
                 style="max-width: 100%; max-height: 400px; object-fit: cover;" 
                 alt="Post image">
          </div>
          
          <div class="d-flex justify-content-between text-muted small mb-2">
            <span>{{post.createdDate | date:'MMM d, y'}}</span>
            <span>{{post.likesCount}} likes â€¢ {{post.commentsCount}} comments</span>
          </div>
          
          <div class="d-flex gap-3 mb-3">
            <button class="btn btn-sm" 
                    [class.btn-primary]="post.isLiked"
                    [class.btn-outline-primary]="!post.isLiked"
                    (click)="likePost(post)">
              <i class="fas fa-heart"></i> Like ({{post.likesCount}})
            </button>
            <button class="btn btn-sm btn-outline-secondary" (click)="commentPost(post)">
              <i class="fas fa-comment"></i> Comment ({{post.commentsCount}})
            </button>
          </div>
          
          <!-- Comments Section -->
          <div *ngIf="showComments[post.id]" class="mt-3">
            <div class="border-top pt-3">
              <div *ngFor="let comment of post.commentsList" class="mb-2">
                <div class="d-flex">
                  <img [src]="comment.author?.profilePicture || 'default.jpg'" 
                       class="rounded-circle me-2" 
                       style="width: 30px; height: 30px; object-fit: cover;" 
                       alt="Avatar">
                  <div class="flex-grow-1">
                    <div class="bg-light rounded p-2 d-flex justify-content-between align-items-start">
                      <div class="flex-grow-1">
                        <strong>{{comment.author?.username}}</strong>
                        <p class="mb-0">{{comment.content}}</p>
                      </div>
                      <button *ngIf="canDeleteComment(comment, post)" 
                              class="btn btn-sm btn-outline-danger ms-2" 
                              (click)="deleteComment(post, comment.id)"
                              style="padding: 2px 6px; font-size: 12px;">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                    <small class="text-muted">{{comment.createdDate | date:'short'}}</small>
                  </div>
                </div>
              </div>
              
              <div class="mt-2">
                <div class="input-group">
                  <input type="text" 
                         class="form-control" 
                         placeholder="Write a comment..." 
                         [(ngModel)]="newComment" 
                         name="comment"
                         (keyup.enter)="addComment(post)">
                  <button class="btn btn-primary" 
                          (click)="addComment(post)" 
                          [disabled]="!newComment?.trim()">
                    Post
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mt-4" *ngIf="posts.length === 0">
      <p class="text-center text-muted">No posts yet.</p>
    </div>
  </div>
</div>

<div class="row" *ngIf="isLoading">
  <div class="col-md-8 mx-auto text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading profile...</p>
  </div>
</div>

<!-- Delete Comment Confirmation Modal -->
<div class="modal fade show" style="display: block; z-index: 1050;" *ngIf="showDeleteCommentConfirm">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: white; border: 1px solid #dee2e6; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);">
      <div class="modal-header" style="background: #f8f9fa; border-bottom: 1px solid #dee2e6;">
        <h5 class="modal-title" style="color: #dc3545; font-weight: bold;">Delete Comment</h5>
      </div>
      <div class="modal-body" style="padding: 1.5rem; background: white;">
        <p style="color: #495057; margin-bottom: 0;">Are you sure you want to delete this comment? This action cannot be undone.</p>
      </div>
      <div class="modal-footer" style="background: #f8f9fa; border-top: 1px solid #dee2e6;">
        <button type="button" class="btn btn-secondary" (click)="cancelDeleteComment()" style="background: #6c757d; border-color: #6c757d;">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDeleteComment()" style="background: #dc3545; border-color: #dc3545;">Delete</button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show" style="background-color: rgba(0, 0, 0, 0.5); z-index: 1040;" *ngIf="showDeleteCommentConfirm"></div>